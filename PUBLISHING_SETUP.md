# Настройка автоматической публикации

## Требуемые секреты в GitHub

Для работы автоматической публикации в npm и GitHub Pages необходимо настроить следующие секреты в настройках репозитория:

### 1. NPM_TOKEN
1. Войдите в [npmjs.com](https://www.npmjs.com/)
2. Перейдите в настройки профиля → Access Tokens
3. Создайте новый токен с правами "Automation"
4. Скопируйте токен и добавьте его как секрет `NPM_TOKEN` в GitHub

### 2. GITHUB_TOKEN
Этот токен создается автоматически GitHub Actions, дополнительной настройки не требуется.

## Настройка GitHub Pages

1. В настройках репозитория перейдите в раздел "Pages"
2. Выберите источник: "GitHub Actions"
3. Сохраните настройки

## Как работает публикация

### Автоматическая публикация
- При пуше в ветку `main` или `master` запускается workflow
- Выполняются тесты и сборка
- Если все успешно, semantic-release анализирует коммиты
- При наличии изменений создается новая версия и публикуется в npm
- Обновляется CHANGELOG.md
- Создается GitHub Release
- Деплоится демо на GitHub Pages

### Ручная публикация
```bash
# Сборка библиотеки
npm run build:lib

# Переход в директорию собранной библиотеки
cd dist/angular-datepicker2

# Публикация
npm publish
```

## Формат коммитов

Для автоматического определения версии используйте conventional commits:

- `feat:` - новая функциональность (minor версия)
- `fix:` - исправление бага (patch версия)
- `BREAKING CHANGE:` - breaking changes (major версия)
- `docs:` - изменения в документации
- `style:` - форматирование кода
- `refactor:` - рефакторинг
- `test:` - добавление тестов
- `chore:` - обновление зависимостей, настройки

## Проверка перед публикацией

```bash
# Установка зависимостей
npm ci

# Проверка линтера
npm run lint

# Запуск тестов
npm run test-once

# Сборка библиотеки
npm run build:lib

# Проверка semantic-release (dry run)
npx semantic-release --dry-run
```

## Устранение проблем

### Ошибка синхронизации package-lock.json
```bash
rm -rf node_modules package-lock.json
npm install
```

### Проблемы с правами публикации
1. Проверьте NPM_TOKEN в секретах GitHub
2. Убедитесь что токен имеет права на публикацию
3. Проверьте что пакет не занят другим пользователем